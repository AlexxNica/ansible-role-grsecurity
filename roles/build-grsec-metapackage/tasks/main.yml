---
- name: Create parent build directory.
  file:
    state: directory
    path: "{{ grsecurity_metapackage_parent_directory }}"

- name: Clean build subdirectory.
  file:
    state: absent
    path: "{{ grsecurity_metapackage_build_directory }}"

- name: Create build subdirectory.
  file:
    state: directory
    path: "{{ grsecurity_metapackage_build_directory }}/DEBIAN"

- name: Copy DEBIAN control file.
  template:
    src: debian-control-file
    dest: "{{ grsecurity_metapackage_build_directory }}/DEBIAN/control"

- name: Build the Debian package.
  command: dpkg-deb --build {{ grsecurity_metapackage_build_directory }}

- name: Fetch metapackage back to localhost.
  fetch:
    src: "{{ grsecurity_metapackage_parent_directory }}/{{ grsecurity_metapackage_name_verbose }}.deb"
    dest: built-packages/
    flat: yes

